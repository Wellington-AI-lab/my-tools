# Cloudflare Worker 配置文件
# 用于新闻聚合 API + 每日早报 + 语义去重

name = "news-api"
main = "src/index.ts"
compatibility_date = "2024-12-28"

# ============================================
# Cron Triggers (每日早报)
# ============================================
# UTC 00:00 = 北京时间 08:00 (早上8点)
[triggers]
crons = ["0 0 * * *"]

# ============================================
# 环境变量
# ============================================
# 以下变量通过 wrangler secret 设置:
#
# RESEND_API_KEY     - Resend API 密钥 (resend.com)
# DIGEST_FROM        - 发件人邮箱
# DIGEST_TO          - 订阅者邮箱列表
# API_SECRET         - API 认证密钥
# ALLOWED_ORIGINS    - 允许的 CORS 来源
#
# 设置命令:
# wrangler secret put RESEND_API_KEY
# wrangler secret put DIGEST_FROM
# wrangler secret put DIGEST_TO

# ============================================
# D1 数据库绑定
# ============================================
[[d1_databases]]
binding = "DB"
database_name = "news-db"
database_id = "56e4016b-3b64-4e09-8010-c10ff0d4cf12"

# ============================================
# Workers AI 绑定 (用于生成 Embeddings)
# ============================================
[ai]
binding = "AI"

# ============================================
# Vectorize 绑定 (语义向量索引)
# ============================================
# 初始化命令:
# npx wrangler vectorize create news-index --dimensions=384 --metric=cosine
# 创建后将生成的 index_id 填入下方
#
# 注意: @cf/baai/bge-small-en-v1.5 模型输出 384 维向量
[[vectorize]]
binding = "VECTORS"
index_name = "news-index"
# index_id = "YOUR_INDEX_ID_HERE"  # 创建后填入
