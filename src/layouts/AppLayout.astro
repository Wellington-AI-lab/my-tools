---
import { MODULES } from '@/config/modules';
import '@/styles/global.css';

const pathname = Astro.url.pathname;
const role = Astro.locals.user?.role ?? 'user';
const title = Astro.props?.title ? `${Astro.props.title} · my tools` : 'my tools';
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>
  <body>
    <header class="sticky top-0 z-40 backdrop-blur bg-white/70 border-b border-black/5">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
        {pathname !== '/' && (
        <nav class="hidden md:flex items-center gap-3 text-sm">
          {MODULES.map((m) => (
            <a
              href={m.href}
              class:list={[
                'px-3 py-1.5 rounded-full border',
                pathname.startsWith(m.href)
                  ? 'bg-onekey-dark-secondary border-onekey-accent-green/40 text-onekey-text-primary'
                  : 'bg-white/60 border-black/10 text-onekey-text-secondary hover:border-onekey-accent-green/30',
              ]}
            >
              {m.name}
            </a>
          ))}
        </nav>
        )}

        <div class="flex items-center gap-2 ml-auto">
          <button
            id="logoutBtn"
            class="text-sm px-3 py-1.5 rounded-full border border-black/10 bg-white/60 hover:border-onekey-accent-green/30"
            type="button"
          >
            登出
          </button>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-6">
      <slot />
    </main>

    <script>
      const btn = document.getElementById('logoutBtn');
      if (btn) {
        btn.addEventListener('click', async () => {
          try {
            await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
          } catch {}
          window.location.href = '/login';
        });
      }
    </script>
  </body>
</html>


