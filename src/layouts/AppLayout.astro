---
import { MODULES } from '@/config/modules';
import '@/styles/global.css';

const pathname = Astro.url.pathname;
const role = (Astro.locals as any)?.user?.role ?? 'user';
const title = Astro.props?.title || 'my tools';
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>
  <body>
    <!-- Titan Header -->
    <header class="titan-header">
      <div class="titan-container">
        <div class="titan-header-inner">
          <!-- Logo -->
          <a href="/" class="titan-logo">
            <span>my tools</span>
          </a>

          <!-- Navigation -->
          {pathname !== '/' && (
          <nav class="titan-nav">
            {MODULES.map((m) => (
              <a
                href={m.href}
                class:list={[
                  'titan-nav-item',
                  pathname.startsWith(m.href) ? 'titan-nav-item-active' : '',
                ]}
              >
                {m.name}
                {m.status && m.status !== 'stable' && (
                  <span class:list={['titan-badge', `titan-badge-${m.status}`]}>
                    {m.status}
                  </span>
                )}
              </a>
            ))}
          </nav>
          )}

          <!-- Actions -->
          <div class="titan-header-actions">
            <button
              id="logoutBtn"
              class="titan-btn titan-btn-ghost titan-btn-sm"
              type="button"
            >
              登出
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="titan-main">
      <slot />
    </main>

    <script>
      const btn = document.getElementById('logoutBtn');
      if (btn) {
        btn.addEventListener('click', async () => {
          try {
            await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
          } catch {}
          window.location.href = '/login';
        });
      }
    </script>

    <style is:global>
      /* --- TITAN HEADER --- */
      .titan-header {
        position: sticky;
        top: 0;
        z-index: 200;
        background-color: #FFFFFF;
        border-bottom: 1px solid #E5E7EB;
      }

      .titan-container {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 16px;
      }

      .titan-header-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
        height: 64px;
      }

      .titan-logo {
        font-size: 1.25rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        color: #1F2937;
        text-decoration: none;
        white-space: nowrap;
      }

      .titan-nav {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
      }

      .titan-nav-item {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        height: 40px;
        padding: 0 16px;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6B7280;
        text-decoration: none;
        border-radius: 9999px;
        transition: all 150ms cubic-bezier(0.33, 1, 0.68, 1);
        white-space: nowrap;
      }

      .titan-nav-item:hover {
        color: #1F2937;
        background-color: #FAFAFA;
      }

      .titan-nav-item-active {
        color: #00B812;
        background-color: #E8F5E9;
      }

      .titan-badge-beta {
        background-color: #FEF3C7;
        color: #D97706;
      }

      .titan-badge-alpha {
        background-color: #FEE2E2;
        color: #DC2626;
      }

      .titan-header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      /* --- TITAN MAIN --- */
      .titan-main {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px 16px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .titan-nav {
          display: none;
        }

        .titan-main {
          padding: 16px 12px;
        }
      }
    </style>
  </body>
</html>
